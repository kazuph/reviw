---
description: タスク完了チェック - エビデンス収集、reviwでレビュー開始
allowed-tools: Bash, Read, Write, Edit, Glob, Grep, TodoWrite, Task
---

# タスク完了チェックリスト

実装が終わったと思ったら、このコマンドを実行して完了基準を満たしているか確認せよ。

## 重要：サブエージェント必須（compact 対策）

**このルールを忘れて「実装しました！」と報告するのは、compact でコンテキストが消えたから。**
**以下の作業は必ずサブエージェント（Task ツール）で実行せよ：**

| 作業 | 理由 | サブエージェント |
|------|------|-----------------|
| 報告書作成・エビデンス整理 | 画像・動画処理で枯渇 | `subagent_type: "report-builder"` |
| webapp-testing | スクショ Read でコンテキスト爆発 | `subagent_type: "general-purpose"` |
| E2E テスト実行 | 長いログでコンテキスト消費 | `subagent_type: "general-purpose"` |

```
悪いパターン（メインスレッドで直接実行）：
   webapp-testing でスクショ撮影
   → スクショを Read
   → コンテキスト枯渇
   → compact 発動
   → /done の内容を忘れる
   → 「実装しました！」で報告
   → 無限ループ

良いパターン（サブエージェントで実行）：
   Task ツールで subagent を起動
   → サブエージェント内で webapp-testing 実行
   → サブエージェントがスクショを確認
   → 結果を要約してメインスレッドに返す
   → メインスレッドのコンテキストは温存
   → /done のルールを覚えたまま報告できる
```

## /do からの引き継ぎ

`/do` で開始したタスクは `.artifacts/<feature>/RESULT.md` に PLAN が記録されている。
まず、その TODO の状態を確認せよ：

```bash
# .artifacts ディレクトリの RESULT.md を確認
cat .artifacts/*/RESULT.md | grep -A 50 "## PLAN"
```

**TODO にチェックが付くということは？**

| チェック状態 | 意味 | 次のアクション |
|-------------|------|---------------|
| `- [ ]` 未チェック | まだ完了していない | 作業を継続せよ |
| `- [x]` チェック済み | **検証済み**で完了 | 次の項目へ |

**重要：「実装しただけ」ではチェックを付けてはならない**

チェックを付けられる条件：
- 実装 + ビルド成功 + 動作確認 + エビデンス収集

## 完了基準（3段階）

| 段階 | 内容 | 進捗 |
|------|------|------|
| 1/3 | 実装完了 | まだ報告するな |
| 2/3 | ビルド・起動・動作検証完了 | まだ報告するな |
| 3/3 | reviw でレビュー → ユーザー承認 | ここで初めて完了 |

```
+---------------------------------------------------------------+
|  実装完了 ≠ タスク完了                                        |
+---------------------------------------------------------------+
|                                                               |
|  「実装しました」→ 差し戻し                                   |
|  「ビルド通りました」→ 差し戻し                               |
|  「動きました（証拠なし）」→ 差し戻し                         |
|                                                               |
|  「証拠付きで動作確認しました」→ ようやくレビュー開始         |
|                                                               |
+---------------------------------------------------------------+
```

## 実装後の必須アクション

以下をすべて実行するまで「完了」と言ってはならない：

### 0. TODO の現状確認（差し戻し判定）

```
現在の TODO 状態を確認し、以下に該当する場合は差し戻す：

- 実装系の TODO だけチェックが付いている → 差し戻し
- 検証系の TODO（ビルド・動作確認）が未チェック → 差し戻し
- エビデンス収集の TODO が未チェック → 差し戻し

差し戻し時は以下を表示：
「実装だけでは完了ではありません。ビルド→動作確認→エビデンス収集を実行してください。」
```

### 1. ビルド実行
   - `npm run build` / `pnpm build` などでエラーがないか確認
   - 型エラー、lint エラーがないか確認

### 2. 開発サーバー起動（Webプロジェクトの場合）
   - 実際にサーバーを起動する

### 3. 動作検証
   - `webapp-testing` スキルを使用してブラウザで実際に操作
   - 期待通りの動作をするか確認

### 4. 報告書作成・エビデンス整理

**report-builder エージェントを使用すること：**

```
Task ツールで subagent_type: "report-builder" を指定
→ artifact-proof スキルが自動ロードされる
→ 報告書作成・エビデンス整理を実行
→ reviw でレビュー開始準備が整う
```

### 5. reviw でレビュー開始

**重要：reviw はフォアグラウンドで起動すること**

```bash
# 動画ファイルを先に開く（あれば）
open .artifacts/<feature>/demo.mp4

# 報告書を reviw で開く（フォアグラウンド）
npx reviw .artifacts/<feature>/RESULT.md
```

reviw でレビューを開始すると：
1. ブラウザが開き、報告書が表示される
2. ユーザーがコメントを付けて Submit & Exit
3. YAML 形式でフィードバックが返ってくる
4. フィードバックを TodoWrite に登録して対応

**フォアグラウンドで起動する理由：**
- ユーザーのレビューコメントを受け取るため
- バックグラウンドだとフィードバックが伝わらない

### 6. フィードバック対応

フィードバックをもらったら：
1. **必ず TodoWrite に登録してから作業開始**
2. Todo の文章は詳細に書く（要約禁止）
3. 修正完了後、再度エビデンス収集 → reviw でレビュー

## reviw の使い方ヒント

```bash
# Markdown を開く
npx reviw report.md

# 複数ファイルを開く
npx reviw file1.md file2.csv

# git diff を開く
git diff HEAD | npx reviw

# ポート指定
npx reviw report.md --port 5000
```

## 禁止事項

- 「実装完了です！」だけの報告
- 動作確認なしの完了宣言
- 証拠なしの「動きました」報告
- モック・スキップ・バイパスによる検証の省略
- **実装しただけで TODO にチェックを付けること**
- **reviw をバックグラウンドで起動すること**

## 報告テンプレート

```
## 実施内容
- [何を実装したか]

## TODO 消化状況（/do からの引き継ぎ）
- [x] 実装: [具体的な内容]
- [x] ビルド: 成功
- [x] 動作確認: webapp-testing で検証済み
- [x] エビデンス: artifact-proof で収集済み

## 検証結果
- ビルド: [成功/失敗]
- 動作確認: [成功/失敗]
- 証跡: [スクリーンショット/動画のパス]

## 確認事項
[ユーザーに確認してほしいことがあれば記載]
```

---

**このチェックリストを満たすまで、タスク完了とは言えない。**
**実装だけで完了を主張した場合、即座に差し戻す。**
**reviw でレビューを受けて初めてタスク完了となる。**
